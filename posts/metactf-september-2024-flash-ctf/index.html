<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MetaCTF September 2024 Flash CTF | He\xED.SPACE</title>
<meta name=keywords content="ctf"><meta name=description content="MetaCTF September 2024 Flash CTF challenges from https://metactf.com"><meta name=author content="Yordan D."><link rel=canonical href=https://hexed.space/posts/metactf-september-2024-flash-ctf/><link crossorigin=anonymous href=/assets/css/stylesheet.eb68de0c89ce5c41c8e240727c36e8afacf48a5fa4e5599e4c5870fec6f0d151.css integrity="sha256-62jeDInOXEHI4kByfDbor6z0il+k5VmeTFhw/sbw0VE=" rel="preload stylesheet" as=style><link rel=icon href=https://hexed.space/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hexed.space/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hexed.space/favicon-32x32.png><link rel=apple-touch-icon href=https://hexed.space/apple-touch-icon.png><link rel=mask-icon href=https://hexed.space/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://hexed.space/posts/metactf-september-2024-flash-ctf/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="MetaCTF September 2024 Flash CTF"><meta property="og:description" content="MetaCTF September 2024 Flash CTF challenges from https://metactf.com"><meta property="og:type" content="article"><meta property="og:url" content="https://hexed.space/posts/metactf-september-2024-flash-ctf/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-19T00:00:00+00:00"><meta property="og:site_name" content="HexED.SPACE"><meta name=twitter:card content="summary"><meta name=twitter:title content="MetaCTF September 2024 Flash CTF"><meta name=twitter:description content="MetaCTF September 2024 Flash CTF challenges from https://metactf.com"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hexed.space/posts/"},{"@type":"ListItem","position":2,"name":"MetaCTF September 2024 Flash CTF","item":"https://hexed.space/posts/metactf-september-2024-flash-ctf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MetaCTF September 2024 Flash CTF","name":"MetaCTF September 2024 Flash CTF","description":"MetaCTF September 2024 Flash CTF challenges from https://metactf.com","keywords":["ctf"],"articleBody":"MetaCTF September 2024 Flash CTF consists of 5 challenges. Only 3 of them are covered here.\nStack Smashers This is the first challenge.\nWe are given the source code for a small C program that takes user input, writes it to a 16-byte buffer (buffer[16]), and then checks if memory.winner is set to true. If it is, the win() function is executed, which prints out the flag.\nThe program uses gets() to read the input. Since gets() is unsafe (it doesn’t perform bounds checking), and there is no input validation, an overflow is possible.\nTo exploit this, we need an input of 17 or more bytes to overflow into the memory of memory.winner. By writing anything to this location, the condition check returns true, and the flag is printed.\nvoid win() { printf(\"Congratulations! You've successfully performed a buffer overflow! Here's your flag: FLAG_REDACTED_IN_SNIPPET\"); //The flag has been removed from this version of the code, in the real running code, it will be printed when this function is called } int main() { struct { char buffer[16]; bool winner; } memory; memory.winner = false; gets(memory.buffer); if (memory.winner) { win(); } else { printf(\"Try again!\\n\"); } } Key For Me The second challenge.\nWe’re thinking of creating an serial key activation system to distribute our CTFs, can you do a quick check to make sure we’re the only ones able to make keys for it? I’m just a little paranoid recently. Here’s the source code, if you do make a key, enter it at nc [REDACTED] 30008 to claim a flag!\n#!/usr/local/bin/python from flag import FLAG def check_key(key): if len(key) != 8 or ord(key[0]) % 5 != 3 or ord(key[1]) % 4 != 2 or not key[2].isdigit() or not key[3].islower() or not ord(key[4]) \u003c= ord(key[3]) + 5 or not key[5].isdigit() or int(key[5]) \u003c= int(key[2]) + 2 or not key[6].islower() or ord(key[6]) \u003e= ord(key[3]) - 3 or not key[7].isupper() or ord(key[7]) \u003e= ord(key[4]) - 4: return False return True def main(): print(\"\"\" MetaCTF Key Validation System _____ / _ \\\\__.--._._--.-_ | |_| ______________\\\\ \\\\_____/ \"\"\") key = input(\"Enter your activation key: \") if check_key(key): print(f\"Congratulations! You unlocked the door, here's your prize: {FLAG}\") return 0 else: print(\"Sadly your key didn't work this time, keep working on it!\") return 1 if __name__ == \"__main__\": main() In this challenge, we need to generate a key to get the flag. The function of interest here is check_key(), which has a single conditional statement with multiple logical conditions. We can break it down to make it easier to understand:\n# Length must be 8 if len(key) != 8: return False # First character - ASCII value must be modulo 5 equals 3. Eg. 8, 15, 28, 33... if ord(key[0]) % 5 != 3: return False # Second character - ASCII value must be modulo 4 equals 2. Eg. 10, 24, 26 if ord(key[1]) % 4 != 2: return False # Third character - Must be a digit if not key[2].isdigit(): return False # Fourth character - Must be in lower case. Eg a-z if not key[3].islower(): return False # Fifth character - ASCII value must be less or equal to the ASCII value of fourth character + 5 if not ord(key[4]) \u003c= ord(key[3]) + 5: return False # Sixth character - Must be a digit and its value must be greater than the value of third character + 2 if not key[5].isdigit() or int(key[5]) \u003c= int(key[2]) + 2: return False # Seventh character - Must be in lower case and its ASCII value must be less the value of fourth character - 3 if not key[6].islower() or ord(key[6]) \u003e= ord(key[3]) - 3: return False # Eighth character - Must be in upper case and its ASCII value must be less than the ASCII value of the fifth character - 4 if not key[7].isupper() or ord(key[7]) \u003e= ord(key[4]) - 4: return False return True We can either write a key generator or try to solve it manually.\nimport random import string def check_key(key): if len(key) != 8 or ord(key[0]) % 5 != 3 or ord(key[1]) % 4 != 2 or not key[2].isdigit() or not key[3].islower() or not ord(key[4]) \u003c= ord(key[3]) + 5 or not key[5].isdigit() or int(key[5]) \u003c= int(key[2]) + 2 or not key[6].islower() or ord(key[6]) \u003e= ord(key[3]) - 3 or not key[7].isupper() or ord(key[7]) \u003e= ord(key[4]) - 4: return False return True def gen_key(): key = [0] * 8 key[0] = chr(random.choice([x for x in range(33, 127) if x % 5 == 3])) key[1] = chr(random.choice([x for x in range(33, 127) if x % 4 == 2])) # Makes sure key[2] and key[5] work together. # key[5] is dependant and it needs to be greater than key[2]+2. This means the maximum value of key[2] can be 6. When key[2]+2=6+2=8, key[5] can only be 9 key[2] = random.choice([x for x in range(0, 7)]) # Makes sure key[3] and key[6] work together. # Must be at least 101(e) key[3] = random.choice(string.ascii_lowercase[5:]) # Makes sure key[4] and key[7] work together. # 69(E). Must be at least 70(F) while True: key[4] = chr(random.choice([x for x in range(33, 127) if x \u003c= ord(key[3])+5 ])) if ord(key[4]) \u003e 69: break # Generates a number between (key[2]+2)+1 and 9. +1 ensures the range begins from greater number. key[5] = random.choice([x for x in range((key[2]+2)+1, 10) ]) key[6] = random.choice([x for x in string.ascii_lowercase if ord(x) \u003c ord(key[3]) - 3 ]) key[7] = random.choice([x for x in string.ascii_uppercase if ord(x) \u003c ord(key[4]) - 4 ]) my_key = \"\".join(map(str, key)) return my_key while True: my_key = gen_key() valid = check_key(my_key) if valid == True: print(my_key) break Run the script to generate a key. Connect to the server. Library I’ve been developing this little book library app in Go, but I think something is wrong with the way it’s handling book requests. Some of the book titles seem to be giving unexpected results… Maybe you can figure it out?\npackage main import ( \"html/template\" \"log\" \"net/http\" \"os\" ) type ReadBook struct{} func (rb ReadBook) ReadBook(filePath string) string { content, err := os.ReadFile(filePath) if err != nil { return \"Error reading file: \" + err.Error() } return string(content) } var books = map[string]string{ \"1984\": \"1984 is a dystopian social science fiction novel by George Orwell.\", \"brave_new_world\": \"Brave New World is a dystopian novel by Aldous Huxley.\", \"f451\": \"Fahrenheit 451 is a dystopian novel by Ray Bradbury.\", } type Book struct { Title string Param string } func homeHandler(w http.ResponseWriter, r *http.Request) { var bookList []Book for key := range books { bookList = append(bookList, Book{ Title: key, Param: key, }) } tmpl := template.Must(template.ParseFiles(\"templates/home.html\")) tmpl.Execute(w, bookList) } func bookHandler(w http.ResponseWriter, r *http.Request) { userBook := r.URL.Query().Get(\"book\") bookContent, validBook := books[userBook] if validBook { tmpl := template.Must(template.ParseFiles(\"templates/book.html\")) tmpl.Execute(w, bookContent) return } if userBook != \"\" { tmpl, err := template.New(\"book\").Parse(userBook) if err != nil { http.Error(w, \"Template parsing error: \"+err.Error(), http.StatusInternalServerError) return } tmpl.Execute(w, ReadBook{}) return } http.Error(w, \"No book specified\", http.StatusBadRequest) } func main() { port := os.Getenv(\"PORT\") if port == \"\" { port = \"8080\" // Default to 8080 if no PORT environment variable is set } http.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"static\")))) http.HandleFunc(\"/\", homeHandler) http.HandleFunc(\"/books\", bookHandler) log.Println(\"Starting server on port \" + port) log.Fatal(http.ListenAndServe(\":\"+port, nil)) } A simple web page built with Go and its template system.\nThe homepage lists all book titles in the library, each linking to a book page with a description. It uses a GET parameter, “book,” to pass the title and handle the request.\nThe file containing the logic is main.go, and two html files inside directory “templates”\nThe function of interest here is bookHandler, which processes the book requests.\nThis is what happens: Here’s the process:\nuserBook is assigned the GET parameter “book”. bookContent, validBook access and retrieve the content from the books map. If validBook is true, the book’s description is displayed in the book.html template. Nothing out of the ordinary. If validBook is false, it checks whether userBook is non-empty, creates a new template named book , and parses userBook, which can contain Go template syntax. Finally, it executes the template with an empty instance of ReadBook{}.\nNo input validation or sanitization. This allows template injetion.\nIn the beginning of the code, you can see the defined empty struct and then the defined function/method ReadBook() for the above-mentioned empty struct. The function has a parameter filePath, and the file at that location is opened, read, and the content returned.\nReferring to Go’s html/template documentation, in order to do the injection we need to use the template syntax - {{ }} and . to access the template’s passed argument - ReadBook{} which can read a file.\nLets try books?book={{.ReadBook “/etc/passwd”}}\nroot:x:0:0:root:/root:/bin/sh bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin .... Or XSS injection.\nIt works. Now the flag.\nbooks?book={{.ReadBook “flag.txt”}}\n","wordCount":"1453","inLanguage":"en","datePublished":"2024-09-19T00:00:00Z","dateModified":"2024-09-19T00:00:00Z","author":{"@type":"Person","name":"Yordan D."},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hexed.space/posts/metactf-september-2024-flash-ctf/"},"publisher":{"@type":"Organization","name":"He\\xED.SPACE","logo":{"@type":"ImageObject","url":"https://hexed.space/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hexed.space/ accesskey=h title="He\xED.SPACE (Alt + H)">He\xED.SPACE</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hexed.space/posts title=Posts><span>Posts</span></a></li><li><a href=https://hexed.space/archives title=Archive><span>Archive</span></a></li><li><a href=https://hexed.space/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://hexed.space/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hexed.space/>Home</a>&nbsp;»&nbsp;<a href=https://hexed.space/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">MetaCTF September 2024 Flash CTF</h1><div class=post-description>MetaCTF September 2024 Flash CTF challenges from https://metactf.com</div><div class=post-meta><span title='2024-09-19 00:00:00 +0000 UTC'>September 19, 2024</span>&nbsp;·&nbsp;Yordan D.</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#stack-smashers>Stack Smashers</a></li><li><a href=#key-for-me>Key For Me</a></li><li><a href=#library>Library</a></li></ul></nav></div></details></div><div class=post-content><p>MetaCTF September 2024 Flash CTF consists of 5 challenges. Only 3 of them are covered here.</p><h2 id=stack-smashers>Stack Smashers<a hidden class=anchor aria-hidden=true href=#stack-smashers>#</a></h2><p>This is the first challenge.</p><p>We are given the source code for a small C program that takes user input, writes it to a 16-byte buffer (<code>buffer[16])</code>, and then checks if <code>memory.winner</code> is set to <code>true</code>. If it is, the <code>win()</code> function is executed, which prints out the flag.</p><p>The program uses <code>gets()</code> to read the input. Since <code>gets()</code> is unsafe (it doesn’t perform bounds checking), and there is no input validation, an overflow is possible.</p><p>To exploit this, we need an input of 17 or more bytes to overflow into the memory of <code>memory.winner</code>. By writing anything to this location, the condition check returns true, and the flag is printed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>win</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Congratulations! You&#39;ve successfully performed a buffer overflow! Here&#39;s your flag: FLAG_REDACTED_IN_SNIPPET&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//The flag has been removed from this version of the code, in the real running code, it will be printed when this function is called
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>buffer</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=n>winner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=n>memory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>memory</span><span class=p>.</span><span class=n>winner</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>gets</span><span class=p>(</span><span class=n>memory</span><span class=p>.</span><span class=n>buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>memory</span><span class=p>.</span><span class=n>winner</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>win</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Try again!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img loading=lazy src=images/stacksmashers1.png alt=challenge></p><h2 id=key-for-me>Key For Me<a hidden class=anchor aria-hidden=true href=#key-for-me>#</a></h2><p>The second challenge.</p><blockquote><p>We&rsquo;re thinking of creating an serial key activation system to distribute our CTFs, can you do a quick check to make sure we&rsquo;re the only ones able to make keys for it? I&rsquo;m just a little paranoid recently. Here&rsquo;s the source code, if you do make a key, enter it at nc [REDACTED] 30008 to claim a flag!</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/local/bin/python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flag</span> <span class=kn>import</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_key</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>8</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=mi>5</span> <span class=o>!=</span> <span class=mi>3</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>!=</span> <span class=mi>2</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>islower</span><span class=p>()</span> <span class=ow>or</span> <span class=ow>not</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>+</span> <span class=mi>5</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>int</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=nb>int</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=mi>2</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span><span class=n>islower</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>-</span> <span class=mi>3</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=o>.</span><span class=n>isupper</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>-</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2> MetaCTF Key Validation System
</span></span></span><span class=line><span class=cl><span class=s2>      _____
</span></span></span><span class=line><span class=cl><span class=s2>     /   _ </span><span class=se>\\</span><span class=s2>__.--._._--.-_
</span></span></span><span class=line><span class=cl><span class=s2>    |   |_| ______________</span><span class=se>\\</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>     </span><span class=se>\\</span><span class=s2>_____/
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter your activation key: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check_key</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Congratulations! You unlocked the door, here&#39;s your prize: </span><span class=si>{</span><span class=n>FLAG</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Sadly your key didn&#39;t work this time, keep working on it!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>  
</span></span></code></pre></div><p>In this challenge, we need to generate a key to get the flag. The function of interest here is check_key(), which has a single conditional statement with multiple logical conditions. We can break it down to make it easier to understand:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=c1># Length must be 8</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># First character - ASCII value must be modulo 5 equals 3. Eg. 8, 15, 28, 33...</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=mi>5</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Second character - ASCII value must be modulo 4 equals 2. Eg. 10, 24, 26    </span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Third character - Must be a digit</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Fourth character - Must be in lower case. Eg a-z</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>islower</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Fifth character - ASCII value must be less or equal to the ASCII value of fourth character + 5</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>+</span> <span class=mi>5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Sixth character - Must be a digit and its value must be greater than the value of third character + 2</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>int</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=nb>int</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Seventh character - Must be in lower case and its ASCII value must be less the value of fourth character - 3</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span><span class=n>islower</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>-</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Eighth character - Must be in upper case and its ASCII value must be less than the ASCII value of the fifth character - 4</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=o>.</span><span class=n>isupper</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>-</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></div><p>We can either write a key generator or try to solve it manually.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_key</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>8</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=mi>5</span> <span class=o>!=</span> <span class=mi>3</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>!=</span> <span class=mi>2</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>islower</span><span class=p>()</span> <span class=ow>or</span> <span class=ow>not</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>+</span> <span class=mi>5</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>int</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=nb>int</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>+</span> <span class=mi>2</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span><span class=n>islower</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>-</span> <span class=mi>3</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=o>.</span><span class=n>isupper</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>-</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_key</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>33</span><span class=p>,</span> <span class=mi>127</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>5</span> <span class=o>==</span> <span class=mi>3</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>33</span><span class=p>,</span> <span class=mi>127</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Makes sure key[2] and key[5] work together.</span>
</span></span><span class=line><span class=cl>    <span class=c1># key[5] is dependant and it needs to be greater than key[2]+2. This means the maximum value of key[2] can be 6. When key[2]+2=6+2=8, key[5] can only be 9</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>7</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Makes sure key[3] and key[6] work together.</span>
</span></span><span class=line><span class=cl>    <span class=c1># Must be at least 101(e)</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span><span class=p>[</span><span class=mi>5</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Makes sure key[4] and key[7] work together.</span>
</span></span><span class=line><span class=cl>    <span class=c1># 69(E). Must be at least 70(F)</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	    <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>33</span><span class=p>,</span> <span class=mi>127</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>&lt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span><span class=o>+</span><span class=mi>5</span> <span class=p>]))</span> 
</span></span><span class=line><span class=cl>	    <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>69</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>	        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generates a number between (key[2]+2)+1 and 9. +1 ensures the range begins from greater number.</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>((</span><span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>+</span><span class=mi>2</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=o>-</span> <span class=mi>3</span> <span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_uppercase</span> <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span> <span class=o>-</span> <span class=mi>4</span> <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>my_key</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>my_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>my_key</span> <span class=o>=</span> <span class=n>gen_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>valid</span> <span class=o>=</span> <span class=n>check_key</span><span class=p>(</span><span class=n>my_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>valid</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=n>my_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span>
</span></span></code></pre></div><p>Run the script to generate a key.
<img loading=lazy src=images/genpy.png alt="key generation"></p><p>Connect to the server.
<img loading=lazy src=images/genpy2.png alt="connect and get flag"></p><h2 id=library>Library<a hidden class=anchor aria-hidden=true href=#library>#</a></h2><blockquote><p>I&rsquo;ve been developing this little book library app in Go, but I think something is wrong with the way it&rsquo;s handling book requests. Some of the book titles seem to be giving unexpected results&mldr; Maybe you can figure it out?</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;html/template&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ReadBook</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>rb</span> <span class=nx>ReadBook</span><span class=p>)</span> <span class=nf>ReadBook</span><span class=p>(</span><span class=nx>filePath</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>content</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>filePath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;Error reading file: &#34;</span> <span class=o>+</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>string</span><span class=p>(</span><span class=nx>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>books</span> <span class=p>=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;1984&#34;</span><span class=p>:</span>            <span class=s>&#34;1984 is a dystopian social science fiction novel by George Orwell.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;brave_new_world&#34;</span><span class=p>:</span> <span class=s>&#34;Brave New World is a dystopian novel by Aldous Huxley.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;f451&#34;</span><span class=p>:</span>            <span class=s>&#34;Fahrenheit 451 is a dystopian novel by Ray Bradbury.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Book</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Title</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Param</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>homeHandler</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>bookList</span> <span class=p>[]</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>key</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>books</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>bookList</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>bookList</span><span class=p>,</span> <span class=nx>Book</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Title</span><span class=p>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Param</span><span class=p>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>tmpl</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>Must</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nf>ParseFiles</span><span class=p>(</span><span class=s>&#34;templates/home.html&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>tmpl</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>bookList</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>bookHandler</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>userBook</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nf>Query</span><span class=p>().</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;book&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>bookContent</span><span class=p>,</span> <span class=nx>validBook</span> <span class=o>:=</span> <span class=nx>books</span><span class=p>[</span><span class=nx>userBook</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>validBook</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>tmpl</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>Must</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nf>ParseFiles</span><span class=p>(</span><span class=s>&#34;templates/book.html&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=nx>tmpl</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>bookContent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>userBook</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>tmpl</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;book&#34;</span><span class=p>).</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>userBook</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;Template parsing error: &#34;</span><span class=o>+</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>tmpl</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>ReadBook</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;No book specified&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>port</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;PORT&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>port</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>port</span> <span class=p>=</span> <span class=s>&#34;8080&#34;</span> <span class=c1>// Default to 8080 if no PORT environment variable is set
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;/static/&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nf>StripPrefix</span><span class=p>(</span><span class=s>&#34;/static/&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nf>FileServer</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>Dir</span><span class=p>(</span><span class=s>&#34;static&#34;</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=nx>homeHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/books&#34;</span><span class=p>,</span> <span class=nx>bookHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Starting server on port &#34;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:&#34;</span><span class=o>+</span><span class=nx>port</span><span class=p>,</span> <span class=kc>nil</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>A simple web page built with Go and its template system.</p><p>The homepage lists all book titles in the library, each linking to a book page with a description. It uses a GET parameter, &ldquo;book,&rdquo; to pass the title and handle the request.</p><p>The file containing the logic is main.go, and two html files inside directory &ldquo;templates&rdquo;</p><p>The function of interest here is <code>bookHandler</code>, which processes the book requests.</p><p>This is what happens:
Here&rsquo;s the process:</p><p><code>userBook</code> is assigned the GET parameter &ldquo;book&rdquo;.
<code>bookContent</code>, <code>validBook</code> access and retrieve the content from the <code>books</code> map.
If <code>validBook</code> is true, the book&rsquo;s description is displayed in the <code>book.html</code> template. Nothing out of the ordinary.
If <code>validBook</code> is false, it checks whether <code>userBook</code> is non-empty, creates a new template named <code>book</code> , and parses <code>userBook</code>, which can contain Go template syntax.
Finally, it executes the template with an empty instance of <code>ReadBook{}</code>.</p><p>No input validation or sanitization. This allows template injetion.</p><p>In the beginning of the code, you can see the defined empty struct and then the defined function/method <code>ReadBook()</code> for the above-mentioned empty struct. The function has a parameter <code>filePath</code>, and the file at that location is opened, read, and the content returned.</p><p>Referring to <a href=https://pkg.go.dev/html/template>Go&rsquo;s html/template documentation</a>, in order to do the injection we need to use the template syntax - {{ }} and . to access the template&rsquo;s passed argument - ReadBook{} which can read a file.</p><p>Lets try books?book={{.ReadBook &ldquo;/etc/passwd&rdquo;}}</p><pre tabindex=0><code>root:x:0:0:root:/root:/bin/sh
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
....
</code></pre><p>Or XSS injection.</p><pre tabindex=0><code>&lt;script&gt;alert(&#39;Injection!&#39;)&lt;/script&gt;
</code></pre><p>It works. Now the flag.</p><p>books?book={{.ReadBook &ldquo;flag.txt&rdquo;}}</p><p><img loading=lazy src=images/library_flag.png alt="inject and get the flag"></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://hexed.space/tags/ctf/>Ctf</a></li></ul><nav class=paginav><a class=prev href=https://hexed.space/posts/metactf-october-2024-flash-ctf/><span class=title>« Prev</span><br><span>MetaCTF October 2024 Flash CTF</span>
</a><a class=next href=https://hexed.space/posts/metactf-buffer-1/><span class=title>Next »</span><br><span>MetaCTF - Buffer overflow</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on x" href="https://x.com/intent/tweet/?text=MetaCTF%20September%202024%20Flash%20CTF&amp;url=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f&amp;hashtags=ctf"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f&amp;title=MetaCTF%20September%202024%20Flash%20CTF&amp;summary=MetaCTF%20September%202024%20Flash%20CTF&amp;source=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f&title=MetaCTF%20September%202024%20Flash%20CTF"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on whatsapp" href="https://api.whatsapp.com/send?text=MetaCTF%20September%202024%20Flash%20CTF%20-%20https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on telegram" href="https://telegram.me/share/url?text=MetaCTF%20September%202024%20Flash%20CTF&amp;url=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MetaCTF September 2024 Flash CTF on ycombinator" href="https://news.ycombinator.com/submitlink?t=MetaCTF%20September%202024%20Flash%20CTF&u=https%3a%2f%2fhexed.space%2fposts%2fmetactf-september-2024-flash-ctf%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://hexed.space/>He\xED.SPACE</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>